{"id":1498,"date":"2020-02-29T16:14:50","date_gmt":"2020-02-29T16:14:50","guid":{"rendered":"https:\/\/golangbyexamples.com\/?p=1498"},"modified":"2020-02-29T16:27:33","modified_gmt":"2020-02-29T16:27:33","slug":"golang-ip-address-http-request","status":"publish","type":"post","link":"https:\/\/golangbyexamples.com\/golang-ip-address-http-request\/","title":{"rendered":"Get the IP address from an incoming HTTP request"},"content":{"rendered":"\n<div id=\"ez-toc-container\" class=\"ez-toc-v2_0_17 counter-hierarchy counter-decimal ez-toc-light-blue\">\n<div class=\"ez-toc-title-container\">\n<p class=\"ez-toc-title\">Table of Contents<\/p>\n<span class=\"ez-toc-title-toggle\"><a class=\"ez-toc-pull-right ez-toc-btn ez-toc-btn-xs ez-toc-btn-default ez-toc-toggle\" style=\"display: none;\"><i class=\"ez-toc-glyphicon ez-toc-icon-toggle\"><\/i><\/a><\/span><\/div>\n<nav><ul class=\"ez-toc-list ez-toc-list-level-1\"><li class=\"ez-toc-page-1 ez-toc-heading-level-1\"><a class=\"ez-toc-link ez-toc-heading-1\" href=\"https:\/\/golangbyexamples.com\/golang-ip-address-http-request\/#Overview\" title=\"Overview\">Overview<\/a><\/li><li class=\"ez-toc-page-1 ez-toc-heading-level-1\"><a class=\"ez-toc-link ez-toc-heading-2\" href=\"https:\/\/golangbyexamples.com\/golang-ip-address-http-request\/#Code\" title=\"Code\">Code<\/a><\/li><\/ul><\/nav><\/div>\n<h1 class=\"has-luminous-vivid-orange-color has-text-color wp-block-heading\"><span class=\"ez-toc-section\" id=\"Overview\"><\/span><strong>Overview<\/strong><span class=\"ez-toc-section-end\"><\/span><\/h1>\n\n\n\n<p class=\"has-medium-font-size\">In this article, we will get the IP address of the client\u00a0for an incoming HTTP request using<\/p>\n\n\n\n<ul class=\"has-medium-font-size wp-block-list\"><li><strong>X-REAL-IP<\/strong> header <\/li><\/ul>\n\n\n\n<ul class=\"has-medium-font-size wp-block-list\"><li>If<strong> X-REAL-IP <\/strong>is empty then we will fall back to <strong>X-FORWARDED-FOR<\/strong> header.<\/li><\/ul>\n\n\n\n<ul class=\"has-medium-font-size wp-block-list\"><li>If <strong>X-FORWARDED-FOR<\/strong> is empty then we will fall back to <strong>RemoteAddr <\/strong>of http.Request struct<\/li><\/ul>\n\n\n\n<p class=\"has-medium-font-size\">Please do note that<\/p>\n\n\n\n<ul class=\"has-medium-font-size wp-block-list\"><li><strong>X-REAL-IP<\/strong> header contains only one IP address of the client machine. Some of the proxy servers such as Nginx populate this header if empty based upon the trust proxies that the request encountered before. Also please note that this header can easily be spoofed by the client.<\/li><\/ul>\n\n\n\n<ul class=\"has-medium-font-size wp-block-list\"><li><strong>X-FORWARDED-FOR<\/strong>&nbsp; is a list of IP addresses &#8211; proxy chaining. Consider it as a request hop log. So if the request originates from the client having IP as <strong>ip1<\/strong>, and then hops through a proxy server with <strong>ip2<\/strong> and then goes through a load balancer having IP as <strong>ip3<\/strong>, then the value of <strong>X-FORWARDED-FOR<\/strong> will be <strong>&#8220;ip1,ip2,ip3&#8221;<\/strong> Therefore it is a good idea to split by <strong>&#8220;,&#8221;<\/strong>.&nbsp; Also, note that it can also be easily spoofed by the client. You should only use this header if you control the proxy which is setting the header<\/li><\/ul>\n\n\n\n<ul class=\"has-medium-font-size wp-block-list\"><li><strong>RemoteAddr<\/strong> contains the real IP address of the client. It is the actual physical IP address that the web server received the connection from and that the response will be sent to. But in case the client is connected through a proxy it will give the IP address of the proxy. Also in case, you are using a load balancer or a reverse proxy server then it will give the address of them. <strong>RemoteAddr<\/strong> represents the IP port combination.<\/li><\/ul>\n\n\n\n<p class=\"has-medium-font-size\">Please refer to this article for more information on X-REAL-IP and X-FORWARDED-FOR header<\/p>\n\n\n\n<p class=\"has-medium-font-size\"><a href=\"https:\/\/distinctplace.com\/2014\/04\/23\/story-behind-x-forwarded-for-and-x-real-ip-headers\/\">https:\/\/distinctplace.com\/2014\/04\/23\/story-behind-x-forwarded-for-and-x-real-ip-headers\/<\/a><\/p>\n\n\n\n<p><\/p>\n\n\n\n<p class=\"has-medium-font-size\">Out of the above 3 values, <strong>RemoteAddr<\/strong> is the most reliable but it will never give correct IP address if the client is behind the proxy or when using a load balancer or a reverse proxy server, therefore the order is first\u00a0 <strong>X-REAL-IP<\/strong> then <strong>X-FORWARDED-FOR<\/strong>\u00a0 and then <strong>RemoteAddr. <\/strong>Although please note that a malicious user can still create the fake <strong>X-REAL-IP<\/strong> and <strong>X-FORWARDED-FOR <\/strong>header<\/p>\n\n\n\n<p><\/p>\n\n\n\n<h1 class=\"has-luminous-vivid-orange-color has-text-color wp-block-heading\"><span class=\"ez-toc-section\" id=\"Code\"><\/span><strong>Code<\/strong><span class=\"ez-toc-section-end\"><\/span><\/h1>\n\n\n\n<p class=\"has-medium-font-size\">Let&#8217;s see a working code in GOLANG<\/p>\n\n\n\n<pre class=\"wp-block-prismatic-blocks\"><code class=\"language-go\">package main\n\nimport (\n    \"fmt\"\n    \"net\"\n    \"net\/http\"\n    \"strings\"\n)\n\nfunc main() {\n    handlerFunc := http.HandlerFunc(handleRequest)\n    http.Handle(\"\/getIp\", handlerFunc)\n    http.ListenAndServe(\":8080\", nil)\n}\n\nfunc handleRequest(w http.ResponseWriter, r *http.Request) {\n    ip, err := getIP(r)\n    if err != nil {\n        w.WriteHeader(400)\n        w.Write([]byte(\"No valid ip\"))\n    }\n    w.WriteHeader(200)\n    w.Write([]byte(ip))\n}\n\nfunc getIP(r *http.Request) (string, error) {\n    \/\/Get IP from the X-REAL-IP header\n    ip := r.Header.Get(\"X-REAL-IP\")\n    netIP := net.ParseIP(ip)\n    if netIP != nil {\n        return ip, nil\n    }\n\n    \/\/Get IP from X-FORWARDED-FOR header\n    ips := r.Header.Get(\"X-FORWARDED-FOR\")\n    splitIps := strings.Split(ips, \",\")\n    for _, ip := range splitIps {\n        netIP := net.ParseIP(ip)\n        if netIP != nil {\n            return ip, nil\n        }\n    }\n\n    \/\/Get IP from RemoteAddr\n    ip, _, err := net.SplitHostPort(r.RemoteAddr)\n    if err != nil {\n        return \"\", err\n    }\n    netIP = net.ParseIP(ip)\n    if netIP != nil {\n        return ip, nil\n    }\n    return \"\", fmt.Errorf(\"No valid ip found\")\n}<\/code><\/pre>\n\n\n\n<p class=\"has-medium-font-size\">Make a curl call<\/p>\n\n\n\n<pre class=\"wp-block-prismatic-blocks\"><code class=\"language-go\">curl -v -X  GET http:\/\/localhost:8080\/getIp<\/code><\/pre>\n\n\n\n<p class=\"has-medium-font-size\"><strong>Output:<\/strong><\/p>\n\n\n\n<pre class=\"wp-block-prismatic-blocks\"><code class=\"language-go\">On my machine it outputs ::1 which is actually loopback address for IPV6<\/code><\/pre>\n\n\n\n<p class=\"has-medium-font-size\">On your machine, it will either output 127.0.0.1 for IPV4 or ::1 for IPV6<\/p>\n\n\n\n<p class=\"has-medium-font-size\"><a href=\"https:\/\/en.wikipedia.org\/wiki\/Localhost\">https:\/\/en.wikipedia.org\/wiki\/Localhost<\/a><\/p>\n","protected":false},"excerpt":{"rendered":"<p>Table of Contents OverviewCode Overview In this article, we will get the IP address of the client\u00a0for an incoming HTTP request using X-REAL-IP header If X-REAL-IP is empty then we will fall&#8230;<\/p>\n","protected":false},"author":1,"featured_media":0,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"spay_email":"","footnotes":"","jetpack_publicize_message":"","jetpack_is_tweetstorm":false},"categories":[1],"tags":[4],"class_list":["post-1498","post","type-post","status-publish","format-standard","hentry","category-tech","tag-golang"],"yoast_head":"<!-- This site is optimized with the Yoast SEO plugin v22.7 - https:\/\/yoast.com\/wordpress\/plugins\/seo\/ -->\n<title>Get the IP address from an incoming HTTP request - Welcome To Golang By Example<\/title>\n<meta name=\"robots\" content=\"index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1\" \/>\n<link rel=\"canonical\" href=\"https:\/\/golangbyexamples.com\/golang-ip-address-http-request\/\" \/>\n<meta property=\"og:locale\" content=\"en_US\" \/>\n<meta property=\"og:type\" content=\"article\" \/>\n<meta property=\"og:title\" content=\"Get the IP address from an incoming HTTP request - Welcome To Golang By Example\" \/>\n<meta property=\"og:description\" content=\"Table of Contents OverviewCode Overview In this article, we will get the IP address of the client\u00a0for an incoming HTTP request using X-REAL-IP header If X-REAL-IP is empty then we will fall...\" \/>\n<meta property=\"og:url\" content=\"https:\/\/golangbyexamples.com\/golang-ip-address-http-request\/\" \/>\n<meta property=\"og:site_name\" content=\"Welcome To Golang By Example\" \/>\n<meta property=\"article:published_time\" content=\"2020-02-29T16:14:50+00:00\" \/>\n<meta property=\"article:modified_time\" content=\"2020-02-29T16:27:33+00:00\" \/>\n<meta name=\"author\" content=\"admin\" \/>\n<meta name=\"twitter:card\" content=\"summary_large_image\" \/>\n<meta name=\"twitter:label1\" content=\"Written by\" \/>\n\t<meta name=\"twitter:data1\" content=\"admin\" \/>\n\t<meta name=\"twitter:label2\" content=\"Est. reading time\" \/>\n\t<meta name=\"twitter:data2\" content=\"3 minutes\" \/>\n<script type=\"application\/ld+json\" class=\"yoast-schema-graph\">{\"@context\":\"https:\/\/schema.org\",\"@graph\":[{\"@type\":\"WebPage\",\"@id\":\"https:\/\/golangbyexamples.com\/golang-ip-address-http-request\/\",\"url\":\"https:\/\/golangbyexamples.com\/golang-ip-address-http-request\/\",\"name\":\"Get the IP address from an incoming HTTP request - Welcome To Golang By Example\",\"isPartOf\":{\"@id\":\"https:\/\/golangbyexamples.com\/#website\"},\"datePublished\":\"2020-02-29T16:14:50+00:00\",\"dateModified\":\"2020-02-29T16:27:33+00:00\",\"author\":{\"@id\":\"https:\/\/golangbyexamples.com\/#\/schema\/person\/8833ea7638dafd763cb1db6c0ca4576f\"},\"breadcrumb\":{\"@id\":\"https:\/\/golangbyexamples.com\/golang-ip-address-http-request\/#breadcrumb\"},\"inLanguage\":\"en-US\",\"potentialAction\":[{\"@type\":\"ReadAction\",\"target\":[\"https:\/\/golangbyexamples.com\/golang-ip-address-http-request\/\"]}]},{\"@type\":\"BreadcrumbList\",\"@id\":\"https:\/\/golangbyexamples.com\/golang-ip-address-http-request\/#breadcrumb\",\"itemListElement\":[{\"@type\":\"ListItem\",\"position\":1,\"name\":\"Home\",\"item\":\"https:\/\/golangbyexamples.com\/\"},{\"@type\":\"ListItem\",\"position\":2,\"name\":\"Get the IP address from an incoming HTTP request\"}]},{\"@type\":\"WebSite\",\"@id\":\"https:\/\/golangbyexamples.com\/#website\",\"url\":\"https:\/\/golangbyexamples.com\/\",\"name\":\"Welcome To Golang By Example\",\"description\":\"\",\"potentialAction\":[{\"@type\":\"SearchAction\",\"target\":{\"@type\":\"EntryPoint\",\"urlTemplate\":\"https:\/\/golangbyexamples.com\/?s={search_term_string}\"},\"query-input\":\"required name=search_term_string\"}],\"inLanguage\":\"en-US\"},{\"@type\":\"Person\",\"@id\":\"https:\/\/golangbyexamples.com\/#\/schema\/person\/8833ea7638dafd763cb1db6c0ca4576f\",\"name\":\"admin\",\"image\":{\"@type\":\"ImageObject\",\"inLanguage\":\"en-US\",\"@id\":\"https:\/\/golangbyexamples.com\/#\/schema\/person\/image\/\",\"url\":\"https:\/\/secure.gravatar.com\/avatar\/?s=96&d=mm&r=g\",\"contentUrl\":\"https:\/\/secure.gravatar.com\/avatar\/?s=96&d=mm&r=g\",\"caption\":\"admin\"},\"url\":\"https:\/\/golangbyexamples.com\/author\/admin\/\"}]}<\/script>\n<!-- \/ Yoast SEO plugin. -->","yoast_head_json":{"title":"Get the IP address from an incoming HTTP request - Welcome To Golang By Example","robots":{"index":"index","follow":"follow","max-snippet":"max-snippet:-1","max-image-preview":"max-image-preview:large","max-video-preview":"max-video-preview:-1"},"canonical":"https:\/\/golangbyexamples.com\/golang-ip-address-http-request\/","og_locale":"en_US","og_type":"article","og_title":"Get the IP address from an incoming HTTP request - Welcome To Golang By Example","og_description":"Table of Contents OverviewCode Overview In this article, we will get the IP address of the client\u00a0for an incoming HTTP request using X-REAL-IP header If X-REAL-IP is empty then we will fall...","og_url":"https:\/\/golangbyexamples.com\/golang-ip-address-http-request\/","og_site_name":"Welcome To Golang By Example","article_published_time":"2020-02-29T16:14:50+00:00","article_modified_time":"2020-02-29T16:27:33+00:00","author":"admin","twitter_card":"summary_large_image","twitter_misc":{"Written by":"admin","Est. reading time":"3 minutes"},"schema":{"@context":"https:\/\/schema.org","@graph":[{"@type":"WebPage","@id":"https:\/\/golangbyexamples.com\/golang-ip-address-http-request\/","url":"https:\/\/golangbyexamples.com\/golang-ip-address-http-request\/","name":"Get the IP address from an incoming HTTP request - Welcome To Golang By Example","isPartOf":{"@id":"https:\/\/golangbyexamples.com\/#website"},"datePublished":"2020-02-29T16:14:50+00:00","dateModified":"2020-02-29T16:27:33+00:00","author":{"@id":"https:\/\/golangbyexamples.com\/#\/schema\/person\/8833ea7638dafd763cb1db6c0ca4576f"},"breadcrumb":{"@id":"https:\/\/golangbyexamples.com\/golang-ip-address-http-request\/#breadcrumb"},"inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["https:\/\/golangbyexamples.com\/golang-ip-address-http-request\/"]}]},{"@type":"BreadcrumbList","@id":"https:\/\/golangbyexamples.com\/golang-ip-address-http-request\/#breadcrumb","itemListElement":[{"@type":"ListItem","position":1,"name":"Home","item":"https:\/\/golangbyexamples.com\/"},{"@type":"ListItem","position":2,"name":"Get the IP address from an incoming HTTP request"}]},{"@type":"WebSite","@id":"https:\/\/golangbyexamples.com\/#website","url":"https:\/\/golangbyexamples.com\/","name":"Welcome To Golang By Example","description":"","potentialAction":[{"@type":"SearchAction","target":{"@type":"EntryPoint","urlTemplate":"https:\/\/golangbyexamples.com\/?s={search_term_string}"},"query-input":"required name=search_term_string"}],"inLanguage":"en-US"},{"@type":"Person","@id":"https:\/\/golangbyexamples.com\/#\/schema\/person\/8833ea7638dafd763cb1db6c0ca4576f","name":"admin","image":{"@type":"ImageObject","inLanguage":"en-US","@id":"https:\/\/golangbyexamples.com\/#\/schema\/person\/image\/","url":"https:\/\/secure.gravatar.com\/avatar\/?s=96&d=mm&r=g","contentUrl":"https:\/\/secure.gravatar.com\/avatar\/?s=96&d=mm&r=g","caption":"admin"},"url":"https:\/\/golangbyexamples.com\/author\/admin\/"}]}},"jetpack_featured_media_url":"","jetpack_publicize_connections":[],"jetpack_sharing_enabled":true,"jetpack_shortlink":"https:\/\/wp.me\/paOs1b-oa","amp_validity":null,"amp_enabled":true,"_links":{"self":[{"href":"https:\/\/golangbyexamples.com\/wp-json\/wp\/v2\/posts\/1498","targetHints":{"allow":["GET"]}}],"collection":[{"href":"https:\/\/golangbyexamples.com\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/golangbyexamples.com\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/golangbyexamples.com\/wp-json\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"https:\/\/golangbyexamples.com\/wp-json\/wp\/v2\/comments?post=1498"}],"version-history":[{"count":8,"href":"https:\/\/golangbyexamples.com\/wp-json\/wp\/v2\/posts\/1498\/revisions"}],"predecessor-version":[{"id":1508,"href":"https:\/\/golangbyexamples.com\/wp-json\/wp\/v2\/posts\/1498\/revisions\/1508"}],"wp:attachment":[{"href":"https:\/\/golangbyexamples.com\/wp-json\/wp\/v2\/media?parent=1498"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/golangbyexamples.com\/wp-json\/wp\/v2\/categories?post=1498"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/golangbyexamples.com\/wp-json\/wp\/v2\/tags?post=1498"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}