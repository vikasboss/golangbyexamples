{"id":4054,"date":"2020-09-22T21:59:58","date_gmt":"2020-09-22T16:29:58","guid":{"rendered":"https:\/\/golangbyexamples.com\/?p=4054"},"modified":"2020-09-22T22:00:15","modified_gmt":"2020-09-22T16:30:15","slug":"how-defer-works-golang","status":"publish","type":"post","link":"https:\/\/golangbyexamples.com\/how-defer-works-golang\/","title":{"rendered":"How does\u00a0defer works in Go (Golang)"},"content":{"rendered":"\n<div id=\"ez-toc-container\" class=\"ez-toc-v2_0_17 counter-hierarchy counter-decimal ez-toc-light-blue\">\n<div class=\"ez-toc-title-container\">\n<p class=\"ez-toc-title\">Table of Contents<\/p>\n<span class=\"ez-toc-title-toggle\"><a class=\"ez-toc-pull-right ez-toc-btn ez-toc-btn-xs ez-toc-btn-default ez-toc-toggle\" style=\"display: none;\"><i class=\"ez-toc-glyphicon ez-toc-icon-toggle\"><\/i><\/a><\/span><\/div>\n<nav><ul class=\"ez-toc-list ez-toc-list-level-1\"><li class=\"ez-toc-page-1 ez-toc-heading-level-1\"><a class=\"ez-toc-link ez-toc-heading-1\" href=\"https:\/\/golangbyexamples.com\/how-defer-works-golang\/#Overview\" title=\"Overview\">Overview<\/a><\/li><li class=\"ez-toc-page-1 ez-toc-heading-level-1\"><a class=\"ez-toc-link ez-toc-heading-2\" href=\"https:\/\/golangbyexamples.com\/how-defer-works-golang\/#Single_Defer\" title=\"Single Defer\">Single Defer<\/a><\/li><li class=\"ez-toc-page-1 ez-toc-heading-level-1\"><a class=\"ez-toc-link ez-toc-heading-3\" href=\"https:\/\/golangbyexamples.com\/how-defer-works-golang\/#Multiple_Defer_function_within_a_particular_function\" title=\"Multiple Defer function within a particular function\">Multiple Defer function within a particular function<\/a><\/li><li class=\"ez-toc-page-1 ez-toc-heading-level-1\"><a class=\"ez-toc-link ez-toc-heading-4\" href=\"https:\/\/golangbyexamples.com\/how-defer-works-golang\/#Multiple_Defer_function_in_different_functions\" title=\"Multiple Defer function in different functions\">Multiple Defer function in different functions<\/a><\/li><\/ul><\/nav><\/div>\n<h1 class=\"wp-block-heading\"><span class=\"ez-toc-section\" id=\"Overview\"><\/span><strong>Overview<\/strong><span class=\"ez-toc-section-end\"><\/span><\/h1>\n\n\n\n<p class=\"has-medium-font-size\">When the  compiler\u00a0encounters a defer statement in a function it pushes it onto a list. This list internally implements a stack-like data structure.\u00a0 All the encountered defer statement\u00a0in the same function are\u00a0pushed onto this list.\u00a0When the surrounding function returns\u00a0then all the functions in the stack starting from top to bottom are executed before\u00a0execution can begin in the calling function. Now the same thing will happen in the calling function as well.<\/p>\n\n\n\n<p class=\"has-medium-font-size\">Let&#8217;s see three cases of defer to better understand how defer works in go<\/p>\n\n\n\n<ul class=\"has-medium-font-size wp-block-list\"><li>Single defer<\/li><li>Multiple defer in the same function<\/li><li>Different defer in different function<\/li><\/ul>\n\n\n\n<p class=\"has-medium-font-size\">Let&#8217;s see an example of each of them<\/p>\n\n\n\n<h1 class=\"wp-block-heading\"><span class=\"ez-toc-section\" id=\"Single_Defer\"><\/span><strong>Single Defer<\/strong><span class=\"ez-toc-section-end\"><\/span><\/h1>\n\n\n\n<pre class=\"wp-block-prismatic-blocks\"><code class=\"language-go\">package main\nimport \"fmt\"\nfunc main() {\n    defer test()\n    fmt.Println(\"Executed in main\")\n}\nfunc test() {\n    fmt.Println(\"In Defer\")\n}<\/code><\/pre>\n\n\n\n<p class=\"has-medium-font-size\"><strong>Output<\/strong><\/p>\n\n\n\n<pre class=\"wp-block-prismatic-blocks\"><code class=\"language-go\">Executed in main\nIn Defer<\/code><\/pre>\n\n\n\n<p class=\"has-medium-font-size\">In the above program there is a <strong>defer<\/strong> statement calling the custom function named <strong>test<\/strong>. As seen from the output, the <strong>test<\/strong> function is called after everything in the main is executed and before main returns. That is why<\/p>\n\n\n\n<pre class=\"wp-block-prismatic-blocks\"><code class=\"language-go\">Executed in main<\/code><\/pre>\n\n\n\n<p class=\"has-medium-font-size\">is printed before<\/p>\n\n\n\n<pre class=\"wp-block-prismatic-blocks\"><code class=\"language-go\">In Defer<\/code><\/pre>\n\n\n\n<h1 class=\"wp-block-heading\"><span class=\"ez-toc-section\" id=\"Multiple_Defer_function_within_a_particular_function\"><\/span><strong>Multiple Defer function within a particular function<\/strong><span class=\"ez-toc-section-end\"><\/span><\/h1>\n\n\n\n<p class=\"has-medium-font-size\">In case we have multiple defer\u00a0functions within a particular function, then all the\u00a0 defer functions will be executed in last in first out order which is similar to what we mentioned above<br><\/p>\n\n\n\n<p class=\"has-medium-font-size\">Let&#8217;s see a program for that<\/p>\n\n\n\n<pre class=\"wp-block-prismatic-blocks\"><code class=\"language-go\">package main\nimport \"fmt\"\nfunc main() {\n    i := 0\n    i = 1\n    defer fmt.Println(i)\n    i = 2\n    defer fmt.Println(i)\n    i = 3\n    defer fmt.Println(i)\n}<\/code><\/pre>\n\n\n\n<p class=\"has-medium-font-size\"><strong>Output<\/strong><\/p>\n\n\n\n<pre class=\"wp-block-prismatic-blocks\"><code class=\"language-go\">3\n2\n1<\/code><\/pre>\n\n\n\n<p class=\"has-medium-font-size\">In the above program we have three <strong>defer<\/strong> function each printing the value of <strong>i<\/strong>. The variable <strong>i<\/strong> is incremented before each defer. The code outputs 3 first meaning that third defer function is executed first.\u00a0 Then it outputs 2 meaning that second defer is executed after that and then it outputs 1 meaning that first defer is executed last. This shows that when there are multiple defer functions within a particular function then the follow the &#8220;Last in first out&#8221; rule. And that is why program outputs\u00a0<\/p>\n\n\n\n<pre class=\"wp-block-prismatic-blocks\"><code class=\"language-go\">3\n2\n1<\/code><\/pre>\n\n\n\n<h1 class=\"wp-block-heading\"><span class=\"ez-toc-section\" id=\"Multiple_Defer_function_in_different_functions\"><\/span><strong>Multiple Defer function in different functions<\/strong><span class=\"ez-toc-section-end\"><\/span><\/h1>\n\n\n\n<p class=\"has-medium-font-size\">Let&#8217;s understand what happens when we have multiple defer functions in different functions.. Imagine a function call from <strong>main<\/strong> function to <strong>f1<\/strong> function to <strong>f2<\/strong> function<\/p>\n\n\n\n<p class=\"has-medium-font-size\"><strong>main<\/strong>-><strong>f1<\/strong>-><strong>f2<\/strong><\/p>\n\n\n\n<p class=\"has-medium-font-size\">Below is the sequence that will be happening after f2 returns<\/p>\n\n\n\n<ul class=\"has-medium-font-size wp-block-list\"><li>Defer functions in <strong>f2<\/strong> will be executed if present. Control will return to the caller which is a function <strong>f1<\/strong>.<\/li><\/ul>\n\n\n\n<ul class=\"has-medium-font-size wp-block-list\"><li>Defer functions in <strong>f1<\/strong> will be executed if present. Control will return to the caller which is a function <strong>main<\/strong>. Note that if there are more functions in between then the process will continue up the stack in a similar way<\/li><\/ul>\n\n\n\n<ul class=\"has-medium-font-size wp-block-list\"><li>After main returns the defer\u00a0 function if present in main will be executed<\/li><\/ul>\n\n\n\n<p class=\"has-medium-font-size\">Let&#8217;s see a program for that<\/p>\n\n\n\n<pre class=\"wp-block-prismatic-blocks\"><code class=\"language-go\">package main\n\nimport \"fmt\"\n\nfunc main() {\n\tdefer fmt.Println(\"Defer in main\")\n\tfmt.Println(\"Stat main\")\n\tf1()\n\tfmt.Println(\"Finish main\")\n}\n\nfunc f1() {\n\tdefer fmt.Println(\"Defer in f1\")\n\tfmt.Println(\"Start f1\")\n\tf2()\n\tfmt.Println(\"Finish f1\")\n}\n\nfunc f2() {\n\tdefer fmt.Println(\"Defer in f2\")\n\tfmt.Println(\"Start f2\")\n\tfmt.Println(\"Finish f2\")\n}<\/code><\/pre>\n\n\n\n<p class=\"has-medium-font-size\"><strong>Output<\/strong><\/p>\n\n\n\n<pre class=\"wp-block-prismatic-blocks\"><code class=\"language-go\">Stat main\nStart f1\nStart f2\nFinish f2\nDefer in f2\nFinish f1\nDefer in f1\nFinish main\nDefer in main<\/code><\/pre>\n","protected":false},"excerpt":{"rendered":"<p>Table of Contents OverviewSingle DeferMultiple Defer function within a particular functionMultiple Defer function in different functions Overview When the compiler\u00a0encounters a defer statement in a function it pushes it onto a list&#8230;.<\/p>\n","protected":false},"author":1,"featured_media":0,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"spay_email":"","footnotes":"","jetpack_publicize_message":"","jetpack_is_tweetstorm":false},"categories":[1],"tags":[3,4],"class_list":["post-4054","post","type-post","status-publish","format-standard","hentry","category-tech","tag-go","tag-golang"],"yoast_head":"<!-- This site is optimized with the Yoast SEO plugin v22.7 - https:\/\/yoast.com\/wordpress\/plugins\/seo\/ -->\n<title>How does\u00a0defer works in Go (Golang) - Welcome To Golang By Example<\/title>\n<meta name=\"robots\" content=\"index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1\" \/>\n<link rel=\"canonical\" href=\"https:\/\/golangbyexamples.com\/how-defer-works-golang\/\" \/>\n<meta property=\"og:locale\" content=\"en_US\" \/>\n<meta property=\"og:type\" content=\"article\" \/>\n<meta property=\"og:title\" content=\"How does\u00a0defer works in Go (Golang) - Welcome To Golang By Example\" \/>\n<meta property=\"og:description\" content=\"Table of Contents OverviewSingle DeferMultiple Defer function within a particular functionMultiple Defer function in different functions Overview When the compiler\u00a0encounters a defer statement in a function it pushes it onto a list....\" \/>\n<meta property=\"og:url\" content=\"https:\/\/golangbyexamples.com\/how-defer-works-golang\/\" \/>\n<meta property=\"og:site_name\" content=\"Welcome To Golang By Example\" \/>\n<meta property=\"article:published_time\" content=\"2020-09-22T16:29:58+00:00\" \/>\n<meta property=\"article:modified_time\" content=\"2020-09-22T16:30:15+00:00\" \/>\n<meta name=\"author\" content=\"admin\" \/>\n<meta name=\"twitter:card\" content=\"summary_large_image\" \/>\n<meta name=\"twitter:label1\" content=\"Written by\" \/>\n\t<meta name=\"twitter:data1\" content=\"admin\" \/>\n\t<meta name=\"twitter:label2\" content=\"Est. reading time\" \/>\n\t<meta name=\"twitter:data2\" content=\"3 minutes\" \/>\n<script type=\"application\/ld+json\" class=\"yoast-schema-graph\">{\"@context\":\"https:\/\/schema.org\",\"@graph\":[{\"@type\":\"WebPage\",\"@id\":\"https:\/\/golangbyexamples.com\/how-defer-works-golang\/\",\"url\":\"https:\/\/golangbyexamples.com\/how-defer-works-golang\/\",\"name\":\"How does\u00a0defer works in Go (Golang) - Welcome To Golang By Example\",\"isPartOf\":{\"@id\":\"https:\/\/golangbyexamples.com\/#website\"},\"datePublished\":\"2020-09-22T16:29:58+00:00\",\"dateModified\":\"2020-09-22T16:30:15+00:00\",\"author\":{\"@id\":\"https:\/\/golangbyexamples.com\/#\/schema\/person\/8833ea7638dafd763cb1db6c0ca4576f\"},\"breadcrumb\":{\"@id\":\"https:\/\/golangbyexamples.com\/how-defer-works-golang\/#breadcrumb\"},\"inLanguage\":\"en-US\",\"potentialAction\":[{\"@type\":\"ReadAction\",\"target\":[\"https:\/\/golangbyexamples.com\/how-defer-works-golang\/\"]}]},{\"@type\":\"BreadcrumbList\",\"@id\":\"https:\/\/golangbyexamples.com\/how-defer-works-golang\/#breadcrumb\",\"itemListElement\":[{\"@type\":\"ListItem\",\"position\":1,\"name\":\"Home\",\"item\":\"https:\/\/golangbyexamples.com\/\"},{\"@type\":\"ListItem\",\"position\":2,\"name\":\"How does\u00a0defer works in Go (Golang)\"}]},{\"@type\":\"WebSite\",\"@id\":\"https:\/\/golangbyexamples.com\/#website\",\"url\":\"https:\/\/golangbyexamples.com\/\",\"name\":\"Welcome To Golang By Example\",\"description\":\"\",\"potentialAction\":[{\"@type\":\"SearchAction\",\"target\":{\"@type\":\"EntryPoint\",\"urlTemplate\":\"https:\/\/golangbyexamples.com\/?s={search_term_string}\"},\"query-input\":\"required name=search_term_string\"}],\"inLanguage\":\"en-US\"},{\"@type\":\"Person\",\"@id\":\"https:\/\/golangbyexamples.com\/#\/schema\/person\/8833ea7638dafd763cb1db6c0ca4576f\",\"name\":\"admin\",\"image\":{\"@type\":\"ImageObject\",\"inLanguage\":\"en-US\",\"@id\":\"https:\/\/golangbyexamples.com\/#\/schema\/person\/image\/\",\"url\":\"https:\/\/secure.gravatar.com\/avatar\/?s=96&d=mm&r=g\",\"contentUrl\":\"https:\/\/secure.gravatar.com\/avatar\/?s=96&d=mm&r=g\",\"caption\":\"admin\"},\"url\":\"https:\/\/golangbyexamples.com\/author\/admin\/\"}]}<\/script>\n<!-- \/ Yoast SEO plugin. -->","yoast_head_json":{"title":"How does\u00a0defer works in Go (Golang) - Welcome To Golang By Example","robots":{"index":"index","follow":"follow","max-snippet":"max-snippet:-1","max-image-preview":"max-image-preview:large","max-video-preview":"max-video-preview:-1"},"canonical":"https:\/\/golangbyexamples.com\/how-defer-works-golang\/","og_locale":"en_US","og_type":"article","og_title":"How does\u00a0defer works in Go (Golang) - Welcome To Golang By Example","og_description":"Table of Contents OverviewSingle DeferMultiple Defer function within a particular functionMultiple Defer function in different functions Overview When the compiler\u00a0encounters a defer statement in a function it pushes it onto a list....","og_url":"https:\/\/golangbyexamples.com\/how-defer-works-golang\/","og_site_name":"Welcome To Golang By Example","article_published_time":"2020-09-22T16:29:58+00:00","article_modified_time":"2020-09-22T16:30:15+00:00","author":"admin","twitter_card":"summary_large_image","twitter_misc":{"Written by":"admin","Est. reading time":"3 minutes"},"schema":{"@context":"https:\/\/schema.org","@graph":[{"@type":"WebPage","@id":"https:\/\/golangbyexamples.com\/how-defer-works-golang\/","url":"https:\/\/golangbyexamples.com\/how-defer-works-golang\/","name":"How does\u00a0defer works in Go (Golang) - Welcome To Golang By Example","isPartOf":{"@id":"https:\/\/golangbyexamples.com\/#website"},"datePublished":"2020-09-22T16:29:58+00:00","dateModified":"2020-09-22T16:30:15+00:00","author":{"@id":"https:\/\/golangbyexamples.com\/#\/schema\/person\/8833ea7638dafd763cb1db6c0ca4576f"},"breadcrumb":{"@id":"https:\/\/golangbyexamples.com\/how-defer-works-golang\/#breadcrumb"},"inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["https:\/\/golangbyexamples.com\/how-defer-works-golang\/"]}]},{"@type":"BreadcrumbList","@id":"https:\/\/golangbyexamples.com\/how-defer-works-golang\/#breadcrumb","itemListElement":[{"@type":"ListItem","position":1,"name":"Home","item":"https:\/\/golangbyexamples.com\/"},{"@type":"ListItem","position":2,"name":"How does\u00a0defer works in Go (Golang)"}]},{"@type":"WebSite","@id":"https:\/\/golangbyexamples.com\/#website","url":"https:\/\/golangbyexamples.com\/","name":"Welcome To Golang By Example","description":"","potentialAction":[{"@type":"SearchAction","target":{"@type":"EntryPoint","urlTemplate":"https:\/\/golangbyexamples.com\/?s={search_term_string}"},"query-input":"required name=search_term_string"}],"inLanguage":"en-US"},{"@type":"Person","@id":"https:\/\/golangbyexamples.com\/#\/schema\/person\/8833ea7638dafd763cb1db6c0ca4576f","name":"admin","image":{"@type":"ImageObject","inLanguage":"en-US","@id":"https:\/\/golangbyexamples.com\/#\/schema\/person\/image\/","url":"https:\/\/secure.gravatar.com\/avatar\/?s=96&d=mm&r=g","contentUrl":"https:\/\/secure.gravatar.com\/avatar\/?s=96&d=mm&r=g","caption":"admin"},"url":"https:\/\/golangbyexamples.com\/author\/admin\/"}]}},"jetpack_featured_media_url":"","jetpack_publicize_connections":[],"jetpack_sharing_enabled":true,"jetpack_shortlink":"https:\/\/wp.me\/paOs1b-13o","amp_validity":null,"amp_enabled":true,"_links":{"self":[{"href":"https:\/\/golangbyexamples.com\/wp-json\/wp\/v2\/posts\/4054","targetHints":{"allow":["GET"]}}],"collection":[{"href":"https:\/\/golangbyexamples.com\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/golangbyexamples.com\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/golangbyexamples.com\/wp-json\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"https:\/\/golangbyexamples.com\/wp-json\/wp\/v2\/comments?post=4054"}],"version-history":[{"count":1,"href":"https:\/\/golangbyexamples.com\/wp-json\/wp\/v2\/posts\/4054\/revisions"}],"predecessor-version":[{"id":4055,"href":"https:\/\/golangbyexamples.com\/wp-json\/wp\/v2\/posts\/4054\/revisions\/4055"}],"wp:attachment":[{"href":"https:\/\/golangbyexamples.com\/wp-json\/wp\/v2\/media?parent=4054"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/golangbyexamples.com\/wp-json\/wp\/v2\/categories?post=4054"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/golangbyexamples.com\/wp-json\/wp\/v2\/tags?post=4054"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}